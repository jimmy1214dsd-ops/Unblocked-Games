  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eaglercraft Chromebook Edition</title>

  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; overflow: hidden;
      background: #000; font-family: Arial, sans-serif;
    }

    /* Container */
    #container { position: relative; width: 100%; height: 100%; z-index: 2; }
    iframe#fr { width: 100%; height: 100%; border: 0; display: none; }

    /* Buttons */
    .fullscreen-button {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px 40px; font: 24px Impact, Arial;
      background: #000; color: #fff;
      border: 2px solid #4a148c; border-radius: 10px;
      cursor: pointer; z-index: 2000;
    }
    .fullscreen-button:hover { background: #4a148c; }

    #confirmation {
      display: none; position: absolute; bottom: 10px; left: 50%;
      transform: translateX(-50%); padding: 10px;
      background: rgba(0,0,0,0.7); color: #fff;
      border-radius: 5px; z-index: 3000;
    }

    /* Stars Background */
    #background {
      position: fixed; inset: 0; z-index: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle, #000, #012c2a);
      overflow: hidden;
    }

    .star {
      position: absolute;
      background: rgb(57,255,215);
      border-radius: 50%;
      transform: scale(0);
      animation: sparkle 2s infinite;
    }

    @keyframes sparkle {
      0%,100% { opacity: 0; transform: scale(0); }
      50% { opacity: 1; transform: scale(1); }
    }

    /* Top-right index2 button */
    .button-container {
      position: fixed; top: 20px; right: 20px; z-index: 5000;
    }
    .navigate-button {
      font-size: 16px; background: #333; color: #fff;
      padding: 10px 20px; border: none; border-radius: 5px;
      cursor: pointer;
    }
    .navigate-button:hover { background: #555; }

    /* Credits */
    .bottom-left {
      position: fixed; bottom: 0; left: 0;
      color: rgba(255,255,255,0.2); padding: 10px;
      z-index: 9999;
    }
  </style>
</head>
<body>

<div id="background"></div>

<div id="container">
  <iframe id="fr" src="about:blank" allowfullscreen></iframe>
  <button class="fullscreen-button" id="fullscreenBtn">Press Here</button>
  <div id="confirmation">Click The Button!</div>
</div>

<div class="button-container">
  <button class="navigate-button" id="runButton">Go to Index2</button>
</div>

<div class="bottom-left">Tacogamerman on Github</div>

<script>
/* =============== STAR BACKGROUND =============== */
(function() {
  var bg = document.getElementById("background");
  for (var i = 0; i < 300; i++) {
    var s = document.createElement("div");
    s.className = "star";
    var size = Math.random() * 3;
    s.style.width = size + "px";
    s.style.height = size + "px";
    s.style.left = Math.random()*100 + "vw";
    s.style.top = Math.random()*100 + "vh";
    s.style.animationDuration = (1.5 + Math.random()*1.5) + "s";
    bg.appendChild(s);
  }
})();

/* =============== NAVIGATION BUTTON =============== */
document.getElementById("runButton").onclick = function() {
  window.location.href = "index2.html";
};

/* =============== CHROMEBOOK PERFORMANCE OPTIONS =============== */
window.eaglercraftXOpts = {
  ram: 512,
  performance: "chromebook",
  reduceChunkLag: true
};

/* GPU hint (Chromebook-friendly) */
window.requestAnimationFrame(()=>{});

/* =============== CACHING SYSTEM =============== */
var DB_NAME = "GameCacheDB";
var STORE_NAME = "GameFiles";
var CACHE_DURATION = 90 * 24 * 60 * 60 * 1000;
var FILE_URL = "https://cdn.jsdelivr.net/gh/PlanetDogeCodes/EagletcraftX@main/egcfixed.xml";

function openDB() {
  return new Promise(function(resolve, reject) {
    var req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = function(ev) {
      var db = ev.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME))
        db.createObjectStore(STORE_NAME, {keyPath:"url"});
    };
    req.onsuccess = e => resolve(e.target.result);
    req.onerror = e => reject(e.target.error);
  });
}

function saveToCache(url, content) {
  return openDB().then(function(db) {
    return new Promise(function(resolve) {
      var tx = db.transaction(STORE_NAME, "readwrite");
      tx.objectStore(STORE_NAME)
        .put({url:url, content:content, timestamp:Date.now()});
      resolve();
    });
  });
}

function getFileFromCache(url) {
  return openDB().catch(()=>null).then(function(db){
    if (!db) return fetch(url).then(r=>r.text());
    return new Promise(function(resolve, reject) {
      var tx = db.transaction(STORE_NAME, "readonly");
      var req = tx.objectStore(STORE_NAME).get(url);
      req.onsuccess = function(ev) {
        var data = ev.target.result;
        if (data && (Date.now()-data.timestamp)<CACHE_DURATION) {
          resolve(data.content);
        } else {
          fetch(url).then(r=>r.text()).then(function(text){
            saveToCache(url,text);
            resolve(text);
          }).catch(()=>reject("Fetch failed"));
        }
      };
      req.onerror = ()=>reject("DB error");
    });
  });
}

/* =============== FULLSCREEN (UNDETECTABLE MODE) =============== */
function openFullscreen() {
  var popup = window.open("", "_blank");
  if (!popup) {
    alert("Popup blocked â€” allow popups for this site.");
    return;
  }

  /* Lightweight loading screen */
  popup.document.open();
  popup.document.write(
    "<!doctype html><html><body><p>Loading... (Chromebook Mode)</p></body></html>"
  );
  popup.document.close();

  /* Load game */
  getFileFromCache(FILE_URL).then(function(text) {
    popup.document.open();
    popup.document.write(text);
    popup.document.close();
  }).catch(function() {
    popup.document.body.innerHTML = "<p>Failed to load Eaglercraft.</p>";
  });
}

/* Bind button */
document.getElementById("fullscreenBtn").onclick = openFullscreen;
document.getElementById("confirmation").style.display = "block";
</script>

</body>
</html>
